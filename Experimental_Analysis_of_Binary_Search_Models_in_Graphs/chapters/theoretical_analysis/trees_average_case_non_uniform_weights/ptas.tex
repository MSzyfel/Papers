\subsection{PTAS for $T||V,w||\sum C_j$}
\begin{theorem}
    Fix $\epsilon>1$. There exists an $\br{1+\epsilon}$-approximation algorithm for $T||V, w||\sum C_i$ running in $O\br{n^{\br{2/\epsilon+3}}\log n/\epsilon}$ time.
    \begin{proof}

To design our PTAS we will make use of the following lemma combined with a non trivial dynamic programming procedure due to \cite{Cicalese2014ImprovedApproxAvgTs,Angelidakis2018ShortestPQ, Berendsohn2024}. Note that, this is not the only way to obtain PTAS, see \cite{SplayTonT}.
\begin{lemma}\label{ptas_lemma}
Fix $\epsilon>1$. For every tree $T$, there exists a decision tree $D$, such that:
\begin{enumerate}
    \item $\COST_{avg,D}\br{T,w}\leq \br{1+\epsilon}\cdot\OPT_{avg}\br{T,w}$,
    \item $\COST_{max,D}\br{T,w}\leq \br{1+\frac{1}{\epsilon}}\cdot\br{\fl{\log n}+1}$
\end{enumerate} 
\begin{proof}
Let $D^*$ be any optimal startegy for $T$. If  $\COST_{max,D}\br{T,w}\leq \fl{\log n}+1$, then the claim follows. Assume contrary. In such case let $T'$ be any non empty subtree of $T$ occuring as the candidate subtree after first ${\fl{\log n}+1}/{\epsilon}$ queries of some branch of the strategy. We build $D$ by altering $D^*$ from now on. At each next level of the decision tree a centroid of a current candidate subtree is scheduled to be queried. In such case each vertex belonging to $T'$ gains additional query time equal to at most $\log \fl{\log n\br{T'}}+1\leq \fl{\log n}+1$ and the depth of $D$ is bounded by $\COST_{max,D}\br{T,w}\leq \br{1+\frac{1}{\epsilon}}\cdot\br{\fl{\log n}+1}$. Additionally, the cost of $D$ is at most:
\begin{align*}
    \COST_{avg,D}\br{T,w}&\leq 
\sum_{v \in V\br{T}}w\br{v}\br{\epsilon\cdot \spr{Q_{D^*}\br{T,v}}+\spr{Q_{D^*}\br{T,v}}}
\\&\leq
\br{1+\epsilon}\cdot \COST_{avg,D^*}\br{T,w}=
\br{1+\epsilon}\cdot\OPT_{avg}\br{T,w}
\end{align*}

\end{proof}
\end{lemma}

We assume that the input tree $T$ is rooted at an arbitrary vertex. If the response to a query contains $r\br{T}$ we say that such response is an \textit{up} response and we say that it is an \textit{down} response otherwise. Let $D$ be a decision tree for $T$. We say that a child of $q\in V\br{D}$ is a \textit{left} child if it is associated with an up response to query at $q$. We say that, it is a \textit{right} response otherwise. Note that any query in $D$ may have at most one left child.

To devise our dynamic program, we will need to use the following generalization of decision trees. An \textit{extended decision tree} $D=V\br{V\br{D}, E\br{D}}$ for the tree $T$ is defined analogously as ordinary decision tree, however we allow $V\br{D}=V\cup U \cup B$, where $V\subseteq V\br{T}$, $U$ is a set of nodes in $V\br{D}$ labeled as \textit{unassigned} and $B$ is a set of nodes in $V\br{D}$ label as \textit{blocked}. We also require if $q\inV\br{D}\in U\cup B$, then $q$ has no right children. The cost of such decision tree is defined the same as the cost of an ordinary decision tree. Note that, any decision tree is also an extended decision tree, and we can easily transform any extended decision tree to obtain an ordinary decision tree. To do so, simply delete every query $q\in U\cup B$. If $q\neq r\br{D}$ and $q$ has a left child, then: If $q$ was a left child of $p\br{q}$, hang the left child of $q$ as a left child of $p\br{q}$. Else if $q$ was a right child of $p\br{q}$, hang the left child of $q$ as a right child of $p\br{q}$.

We will also define a \text{timeline} $P$ to be an extended decision tree consisting of sequence of queries $\angl{p_1,\dots,p_k}$, such that every query of $P$ is either blocked or unassigned. We will build our decision trees around timelines. Let $D$ be any extedned decision tree. Define the \textit{left path} $P_D=\angl{q_1,\dots,q_h}$ of $D$ as the sequence of queries in $D$, obtained by traversing $D$ starting from $r\br{D}$, and stepping to the left child until there is none. We will say that a decision tree $D$ with a left path $P_D=\angl{p_1,\dots,p_k}$ is \textit{compatible} with a timeline $P=\angl{q_1,\dots,q_h}$, such that $h\leq k$, if for every integer $1\leq l \leq h$, if $q_l\in B$, then $p_l\in B$. 

We will now introduce the subproblems which our dynamic programming solves. A problem $\OPT\br{T_{v,i}, P}$ consist of finding an optimal extended decision tree for the tree $T_{v,i}$, which is compatible with $P$. Additionally, a global parameter $h$ is given which bounds the maximum height of the solution found by the algorithm and in consequence, the length of $P$. The algorithm computes the solutions in a bottom-up, left-to-right manner. If at any point there is no way to create an extended decision tree with given parameters we simply declare such instance \textit{unfeasible}. The choice of the constant $h$ will ensure existence of at least one such solution. We will now show how to compute $\OPT\br{T_{v,i}, P}$ efficiently. The Algorithm \ref{dp_timelines} consists of 3 cases, for a visual example see Figure \ref{cases_dp_timelines_figure}:
\
\input{figures/cases_of_dp_timelines.tex}
\input{pseudocodes/dp_timelines.tex}

    \begin{enumerate}
        \item $T_{v,0}$, in this case we greedily pick the smallest index $1 \leq k \leq \spr{P}$, such that $p_k$ is unassigned. If there is no such index, we declare the subproblem unfeasible. In other case, the solution obtained by taking timeline $P$ and setting $p_k=v$. The cost of such solution is $w(v)\cdot k$.
        \item $T_{v,1}$, let $u$ be the unique child of $v$ in $T_{v,1}$. We assume that we have already solved all the subproblems of $T_u$.
        We iterate through all possible choices of $1\leq k \leq h$, such that $p_k$ is unassigned. If there are no such choices, we declare the subproblem unfeasible. If otherwise, for each such $k$, we create an auxiliary timeline $P_k'=
        \angl{p_1',\dots,p_h'}$, such that $p_l'=p_l$ for $l < k$, $p_k'$ is blocked and $p_l'$ is unassigned for $l>k$. We consider an optimal extended decision tree $D'_k$ for an instance $\mathcal{P}\br{T_{u}, P_k'}$. In order to create a new decision tree $D_k$, for each choice of $k$, we proceed as follows: Let $q'_k$ be the $k$-th vertex of the left path of $D'_k$. We set $q'_k=v$ Then, we take the left child of $q'_k$ in $D'$ and we rehang it as the right child of $q'_k$.
        % Additionally we fill the left path of $D'$ with blocked and unassigned vertices in order to make it again compatible with $P$.
        The cost of each such extedned decision tree is $\OPT\br{T_{u}, P_k'}+w(v)\cdot k$. We then return an optimal extended decision tree $D$, which minimizes the cost.
        \item $T_{v,i}$ for $i>1$, we assume that we have already solved all the subproblems of $T_{v,i-1}$ and $T_{c_i}$. Let $I$ be a set of indices of unassigned nodes of $P$, i.e. $I=\brc{l | p_l \text{ is unassigned}}$. Consider any bipartition $\br{I_1, I_2}$ of $I$. We create a timeline $P_1=\angl{p_{1,1},\dots,p_{1,h}}$ from timeline $P$, by blocking all of the nodes in $P$ whose indices do not belong to $I_1$. We now consider an extended decision tree $D_1$ for $\mathcal{P}\br{T_{v,i-1}, P_1}$, with a left path $\angl{q_{1,1},\dots,q_{1,d_1}}$. Let $k$ be the index of query to $v$, such that $q_{1,k}=v$. We construct $P_2=\angl{p_{2,1},\dots, p_{2,h}}$ as follows: for any $1\leq l\leq h$, we set $p_{2,l}$ to be unassigned if $l\in I_k^2$ or $l < k$ and we set $p_{2,l}$ to be blocked otherwise. Let $D_2$ be an optimal extended decision tree for $\mathcal{P}\br{T_{c_i}, P_2}$ and let $\angl{q_{2,1},\dots,q_{2,d_2}}$ be its left path. We proceed as follows. Firstly, we rehang the left child of $q_{2,k}$ in $D_2$ as its unique right child (by construction $q_{2,k}$ is blocked in $D_2$). Then, we build $D$ by aligning $D_1$ and $D_2$ by their left paths: For $1\leq l \leq k$, if $p_l$ is blocked then $q_l$ is blocked. Else, if $p_{1,l}$ is unassigned, then $q_l=q_{1,l}$. Else, if  $p_{2,l}$ is unassigned, then $q_l=q_{2,l}$. For $k<l\leqh$ we set $q_l=q_{1,l}$. Since the unassigned nodes above the $k$-th node of left paths of $D_1$ and $D_2$ have no conflicts and $D_2$ has no vertices in its left path beyond $q_{2,k}$, by construction we obtain a valid extended decision tree $D$. The cost of such solution is $\OPT\br{T_{v,i-1}, P_1}+\OPT\br{T_{c_i}, P_2}$. We then return an optimal extended decision tree $D$, which minimizes the cost. For a visual example, see \ref{dp_timelines_figure}.
    \end{enumerate}
    
\input{figures/dp_timelines.tex}
    Let $P=\angl{p_1,\dots,p_h}$, such that for every integer $1\leq k \leq h$, $p_k\in U$. Let $h=\br{1+\frac{1}{\epsilon}}\cdot\br{\fl{\log n}+1}$. Since, any extended decision tree of depth at most $h$ is compatible with $P$ by Lemma \ref{ptas_lemma} we have that for $D$ calculated for $\OPT\br{T, P}$,
    $\COST_{D}\br{T,w}\leq \br{1+\epsilon}\cdot\OPT\br{T,w}$.

    There are at most $O\br{n}$ subtrees $T_{v,i}$, $2^h$ different timelines and each subproblem requires $O\br{h+2^h\cdot h}=O\br{2^h\cdot h}$ amount of computation, since there are at most $2^h$ bipartitions of unassigned vertices of any timeline and aligning two decision trees requires $O\br{h}$ time. Therefore, the running time of the procedure is bounded by $O\br{n\cdot 2^{2h}\cdot h}=O\br{n^{\br{2/\epsilon+3}}\cdot \log \br{n/\epsilon}}$ as required.
    
\end{proof}
\end{theorem}