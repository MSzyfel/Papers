\begin{algorithm}
\caption{The main recursive procedure}\label{createDecisionTree}
\SetKwProg{Fn}{Procedure}{:}{}
\Fn{$\FCreateDecisionTree\br{\mathcal{T}, c, \left(a,b\right]}$}{
    \If{\textnormal{$b \leq 1/\log n$ \textbf{or} for every $ v\in V\br{\mathcal{T}}, c\br{v} > a$ }\tcp*{Every $v\in\mathcal{T}$ is heavy}}{
        \Return $\FRankingBasedDT\br{\mathcal{T}}$\label{basecaseDT} \tcp*{Apply Corollary \ref{vertexRankingCorollary}}
    }
    \Else{
        $\mathcal{X}\gets\emptyset$.

        \ForEach{$H\in\mathcal{H}_{\mathcal{T}, c}\br{a}$}{
            Pick arbitrary $v\in H$.
            
            $\mathcal{X}\gets\mathcal{X}\cup\brc{v}$.
        }

        $\mathcal{Z}\gets\mathcal{Y}\gets\mathcal{X}\cup\brc{v\in V\br{\mathcal{T}\angl{\mathcal{X}}} \mid \deg_{\mathcal{T}\angl{\mathcal{X}}}\br{v}\geq 3}$.

        \ForEach{\textnormal{$u,v\in \mathcal{Y}$ with $\mathcal{P}_{\mathcal{T}}\br{u,v}\neq\emptyset$ and $\mathcal{P}_{\mathcal{T}}\br{u,v}\cap \mathcal{Y}=\emptyset$}}{
            $\mathcal{Z}\gets \mathcal{Z}\cup\brc{\argmin_{z\in \mathcal{P}_{\mathcal{T}}\br{u, v}}\brc{c\br{z}}}$.  \tcp*{Lightest vertex on path}
        }

        $\mathcal{T}_{\mathcal{Z}} \gets \br{\mathcal{Z}, \brc{uv \mid \mathcal{P}_{\mathcal{T}}\br{u,v}\cap\mathcal{Z}=\emptyset}}$ \tcp*{Build auxiliary tree}

        $D \gets D_{\mathcal{Z}} \gets \FQPTAS\br{\mathcal{T}_{\mathcal{Z}}, c, \epsilon = 1}$\label{QPTAScall} \tcp*{Apply Theorem \ref{QPTAS}}

        \ForEach{$\mathcal{T}' \in \mathcal{T}-\mathcal{Z}$}{
            $H \gets$ the unique heavy module in $\mathcal{T}'$.

            $D_H \gets \FRankingBasedDT\br{\mathcal{T}'\angl{H}}$ \tcp*{Apply Corollary \ref{vertexRankingCorollary}}

            Hang $D_H$ in $D$ below the last query to $v \in N_{\mathcal{T}}\br{\mathcal{T}'}$ \tcp*{By Obs. \ref{neighborsPathObservation}}

            \ForEach{$L \in \mathcal{T}' - H$}{
                $D_L \gets \FCreateDecisionTree\br{L, c, \left(a/2,a\right]}$.\label{recursion}

                Hang $D_L$ in $D$ below the last query to $v \in N_{\mathcal{T}'}\br{L}$ \tcp*{By Obs. \ref{neighborsPathObservation}}
            }
        }

        \Return $D$.
    }
}
\end{algorithm}
