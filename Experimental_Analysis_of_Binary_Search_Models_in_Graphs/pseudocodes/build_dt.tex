
\begin{algorithm}
\caption{The \FBuildDT procedure ( $p, k$, and $d$ are global parameters).}\label{qptas_pseudocode}
\SetKwProg{Fn}{Procedure}{:}{}
\Fn{$\FBuildDT\br{T, c, F_C}$}{
    \If{$c\br{r\br{T}}>pc$}{
        $D\gets\br{\brc{r\br{F_C}}, \emptyset}$.

        \ForEach{\textnormal{$\mathcal{T}'\in T-r\br{D}$ and forest $F'_C\in D-r\br{D}$, such that $V\br{F'_C} = V\br{T'}$}}{
            $D'\gets\FBuildDT\br{T', c, F'_C}$.

            Hang $D'$ in $D$ below $r\br{D}$.
        }

    }
    \Else{
        $V_L\gets \brc{v\in V\br{T}|c\br{c}\leq pk}$. 

        \ForEach{\textnormal{$v\in V\br{F_C}$ and ancestor $u$ of $v$ in $F_C$}}
        {
            \If{\textnormal{$v$ is an ancestor of $u$ in $T$}}
            {
                $V_L$\gets $V_L - u$
            }
        }
        $V_M\gets V_L\cup \brc{v\in V\br{T}|c\br{v} > pk \text{ and for every ancestor $u$ of $v$}, c\br{u}> pk}$.

        $T_{M}\gets \br{V_M, \brc{uv|u,v\in V_M, \mathcal{P}_{u,v}\cap V_M=\emptyset}}$.

        $\mathcal{D}\gets$ dictionary, such that for each $v\in V_M$, $\mathcal{D}[v]\gets \emptyset$.

        \ForEach{\textnormal{$T'\in T-V_M$ and forest $F'_C\in D-V_M$, such that $V\br{F'_C} = V\br{T'}$}}
        {
            $D'\gets \FBuildDT\br{T',c, D'_C}$.

            $\mathcal{D}[p]\gets \mathcal{D}[p] \cup \brc{D'}$.
        }
        $D\gets \FDPTimelinesCosts\br{T_M, c, \mathcal{D}}$.

    }
    \Return $D$.
}
\end{algorithm}