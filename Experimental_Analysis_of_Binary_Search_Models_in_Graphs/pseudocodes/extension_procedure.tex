
\begin{algorithm}[H]
\caption{The extension procedure}
\label{extensionProcedure}
\SetKwFunction{FExtendDecTree}{ExtendDecTree}
\SetKwFunction{FQPTAS}{QPTAS}
\SetKwProg{Fn}{Procedure}{:}{}
\Fn{\FExtendDecTree{$\mathcal{T}$, $D_C$, $\left(a,b\right]$}}{
    $\mathcal{H} \gets \brc{H \subseteq V \mid H \text{ is a heavy module}}$\;
    
    $\mathcal{X} \gets \emptyset$\;
    
    \For{$H \in \mathcal{H}$}{
        Pick $v \in H$ and add $v$ to $\mathcal{X}$\;
    }
    
    $\mathcal{Z} \gets \mathcal{Y} \gets \mathcal{X} \cup \brc{v \in \mathcal{T}\angl{\mathcal{X}} \mid \deg_{\mathcal{T}\angl{\mathcal{X}}}\br{v} \geq 3}$\;
    \tcp{Branching vertices in $\mathcal{T}\angl{X}$.}
    \For{$u,v \in \mathcal{Y}$, $\mathcal{P}_{\mathcal{T}}\br{u,v} \neq \emptyset$, $\mathcal{P}_{\mathcal{T}}\br{u,v} \cap \mathcal{Y} = \emptyset$}{
        Add $\argmin_{z \in \mathcal{P}_{\mathcal{T}}\br{u,v}} \brc{c\br{z}}$ to $\mathcal{Z}$\;
        \tcp{Lightest vertex on path $P_{\mathcal{T}}\br{u,v}$.}
    }
    $\mathcal{T}_{\mathcal{Z}} \gets \br{\mathcal{Z}, \brc{uv \mid \mathcal{P}_{\mathcal{T}}\br{u,v} \cap \mathcal{Z} = \emptyset}}$\;
    
    $D \gets D_{\mathcal{Z}} \gets$ \FQPTAS{$\mathcal{T}_{\mathcal{Z}}, \epsilon = 1$}\;
    \For{$\mathcal{T}' \in \mathcal{T} - \mathcal{Z}$}{
        Let $H$ be the heavy module in $\mathcal{T}'$\;
        
        $D_H \gets$ a decision tree built by using the vertex ranking of $\mathcal{T}\angl{H}$\;
        
        Hang $D_H$ in $D$ below the last query to a vertex $v \in N_{\mathcal{T}}\br{\mathcal{T}'}$\;
        
        \For{$L \in \mathcal{T}' - H$}{
            $D_L \gets$ a decision tree built by deleting all queries in $D_C$ outside of $L$\;
            
            Hang $D_L$ in $D$ below the last query to a vertex $v \in N_{\mathcal{T}'}\br{L}$\;
        }
    }
    \Return $D$\;
}
\end{algorithm}
